<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAG Playground ‚Äî Upload, Ingest & Chat</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c3aed; --muted:#9aa4b2; --glass:rgba(255,255,255,0.04);
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071021 0%, #0b1220 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:1100px;max-width:100%;display:grid;grid-template-columns:360px 1fr;gap:20px}

    /* left column */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h2{margin:0 0 12px 0;font-size:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px}
    input[type=file]{display:block}
    .btn{background:linear-gradient(90deg,var(--accent),#5b21b6);padding:10px 12px;border-radius:8px;border:none;color:white;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .status{margin-top:12px;padding:10px;border-radius:8px;background:var(--glass);font-size:13px}
    .file-meta{margin-top:12px;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}

    /* right column */
    .chat{display:flex;flex-direction:column;height:680px}
    .messages{flex:1;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px}
    .message{max-width:80%;padding:12px;border-radius:10px}
    .from-user{align-self:flex-end;background:linear-gradient(90deg,#0ea5a4,#06b6d4);color:#04101a}
    .from-system{align-self:flex-start;background:rgba(255,255,255,0.03);color:var(--muted)}
    .controls{display:flex;gap:8px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));border-radius:10px}
    textarea{flex:1;min-height:48px;max-height:120px;border-radius:8px;padding:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;resize:none}
    .meta{font-size:12px;color:var(--muted);margin-top:8px}

    footer{margin-top:18px;color:var(--muted);font-size:12px}

    @media (max-width:960px){.app{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h2>Document Ingestion</h2>
      <label>Upload PDF (company docs)</label>
      <input id="fileInput" type="file" accept="application/pdf" />
      <div style="height:10px"></div>
      <div class="row">
        <button id="uploadBtn" class="btn" onclick="upload()">Upload & Ingest</button>
        <button id="deleteBtn" class="btn secondary" onclick="deleteDocument()">Delete Document</button>
      </div>

      <div class="status" id="status">No document uploaded.</div>

      <div class="file-meta" id="fileMeta" style="display:none">
        <div><strong id="fileName"></strong></div>
        <div class="small" id="fileSize"></div>
        <div class="small" id="pageCount"></div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />
      <h2>Options & Debug</h2>
      <label>Model for generation</label>
      <select id="llmModel">
        <option value="gemini-pro">Gemini (recommended)</option>
        <option value="gpt-4o">GPT (if available)</option>
      </select>

      <div class="meta">This UI expects a backend with endpoints: <code>/upload</code>, <code>/query</code>, <code>/delete</code>. See instructions below.</div>

      <footer>
        Save embeddings to FAISS on the server. After ingesting, the original file can be removed.
      </footer>
    </div>

    <div class="card chat">
      <h2>RAG Chat</h2>
      <div class="messages" id="messages"></div>

      <div class="controls">
        <textarea id="userInput" placeholder="Ask something about the uploaded documents..."></textarea>
        <button id="sendBtn" class="btn" onclick="handleAsk()">Ask</button>
      </div>
      <div class="meta" id="lastActivity">Last action: none</div>
    </div>
  </div>

  <script>

// Utility: append chat bubble
function appendMessage(text, from='system'){
  const div = document.createElement('div');
  div.className = 'message ' + (from === 'user' ? 'from-user' : 'from-system');
  div.innerText = text;
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

// Upload function
async function upload() {
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];
  if (!file) {
    alert("No file selected");
    return;
  }
  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch("/upload", { method: "POST", body: formData });
    const data = await res.json();
    document.getElementById("status").innerText = data.message || "Uploaded";
    alert("Upload successful ‚úÖ");
  } catch (err) {
    alert("Upload failed: " + err.message);
  }
}

// Send query

async function askQuestion(query) {
  try {
    const response = await fetch("/query", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: query, model: "gemini-pro" })
    });
    const data = await response.json();
    appendMessage(query, 'user');
    appendMessage(data.answer || "No answer returned", 'system');
  } catch (err) {
    appendMessage("Error: " + err.message, 'system');
  }
}



async function deleteDocument(){
  try {
    const response = await fetch("/delete", {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });
    const data = await response.json();
    document.getElementById("status").innerText = data.message || "Deleted";
    alert("Document deleted successfully üóëÔ∏è");
  } catch (err) {
    alert("Delete failed: " + err.message);
  }
}

// Handle ask button
function handleAsk() {
  const input = document.getElementById("userInput");
  const q = input.value.trim();
  if (!q) return;
  input.value = "";
  askQuestion(q);
}



// Append message helper
function appendMessage(text, from = 'system') {
  const div = document.createElement('div');
  div.className = 'message ' + (from === 'user' ? 'from-user' : 'from-system');
  div.innerText = text;
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop =
    document.getElementById('messages').scrollHeight;
}


  </script>
</body>
</html>
